(function(a){a.widget("lws.lac_checklist",{options:{classe:"",name:"",placeholder:"",shared:false,addlabel:"Add",delay:300,minlength:0,minoptions:2,minsearch:1,rows:3},_create:function(){this.checkedList={};this.preventNext=false;this.initList=(this.element.data("value")!=undefined&&this.element.data("value").trim()!="")?lwsBase64.toObj(this.element.data("value")):undefined;this.name=this.element.prop("name");this.element.data("lw_name",this.name).prop("name","");this.colWidths=["auto","380px","187px","123px"];this._setOptions();this._createStructure();this._manageModel();this.resList=a(this.model).lac_model("getSource");this._setResList(this.resList);this.container.on("click",".lac-tag-remove",this._bind(this._delTag,this));this.container.on("click",".lac-checklist-resicon",this._bind(this._toggleCheckList,this));this.container.on("click",".lac-checklist-basebutton",this._bind(this._openCheckList,this));this.container.on("click",".lac-checklist-searchbtn",this._bind(this._openSearch,this));this.container.on("click",".lac-checklist-resetbtn",this._bind(this._resetSearch,this));this.container.on("click",".lac-checklist-close",this._bind(this._closeCheckList,this));this.container.on("click",".lac-checklist-item",this._bind(this._selectItem,this));this.container.on("focus",".lac-checklist-input",this._bind(this._openSearch,this));this.container.on("keydown",this._bind(this._manageKeys,this));this.element.on("change",this._bind(this._changeElement,this));a(document).on("click",this._bind(this._manageFocus,this));var b=this;var d;var c=[];this.container.keyup(function(e,f){c[0]=e.key;c[1]=e.keyCode;sentData=[c];d&&clearTimeout(d);d=setTimeout(b._bindD(b._manageSearch,b,sentData),b.options.delay)})},_bind:function(b,c){return function(){return b.apply(c,arguments)}},_bindD:function(b,c,d){return function(){return b.apply(c,d)}},_setOptions:function(){if(this.element.data("placeholder")!=undefined){this.options.placeholder=this.element.data("placeholder")}if(this.element.data("delay")!=undefined){this.options.delay=this.element.data("delay")}if(this.element.data("class")!=undefined){this.options.classe=this.element.data("class")}if(this.element.data("shared")!=undefined){this.options.shared=this.element.data("shared")}},_createStructure:function(){this.container=this.element.parent();a("<div>",{"class":"lac-checklist-wrapper "}).append(a("<div>",{"class":"lac-checklist-top"}).append(a("<div>",{"class":"lac-checklist-combo"}).append(a("<div>",{"class":"lac-checklist-basebutton",html:this.options.placeholder})).append(a("<div>",{"class":"lac-checklist-searchdiv"}).append(a("<div>",{"class":"lac-checklist-searchbtn lws-icon-search"})).append(a("<input>",{"class":"lac-checklist-input "+this.options.classe,placeholder:"Search...",name:this.options.name})).append(a("<div>",{"class":"lac-checklist-resetbtn lws-icon-undo2"}))).append(a("<div>",{"class":"lac-checklist-close",html:"OK"}))).append(a("<div>",{"class":"lac-checklist-list","data-open":false})).append(a("<div>",{"class":"lac-checklist-error"}))).append(a("<div>",{"class":"lac-checklist-bottom"}).append(a("<div>",{"class":"lac-checklist-tags"}))).append(a("<div>",{"class":"lac-checklist-values"})).appendTo(this.container);this.element.hide().detach().prependTo(this.container.find(".lac-checklist-wrapper"));this.selectList=this.container.find(".lac-checklist-list");this.tagsList=this.container.find(".lac-checklist-tags");this.textInput=this.container.find(".lac-checklist-input")},_manageModel:function(){if(this.options.shared){if(a("#sha-"+this.options.shared).length){this.model=a("#sha-"+this.options.shared)}else{this.model=a("<input>",{id:"sha-"+this.options.shared,type:"hidden"}).appendTo(a("body"))}}else{this.model=this.element}a(this.model).lac_model({resChange:{target:this,fn:this._resultChanged},resLoad:{target:this,fn:this._ajaxLoading},mode:"research",dom:a(this.element),viewoptions:this.options});if(this.initList!=undefined){a(this.model).lac_model("returnLabels",this.initList,this)}},_changeElement:function(b){this.checkedList={};this.initList=(this.element.data("value")!=undefined&&this.element.data("value").trim()!="")?lwsBase64.toObj(this.element.data("value")):undefined;a(this.model).lac_model("returnLabels",this.initList,this)},_openCheckList:function(){this.container.find(".lac-checklist-close").show();this.selectList.data("open",true);this.selectList.css("display","flex");this._calcColumns()},_closeCheckList:function(){if(this.selectList.data("open")==true){this.container.find(".lac-checklist-searchdiv").animate({width:"26px"},500);this.container.find(".lac-checklist-basebutton").html(this.options.placeholder);this.container.find(".lac-checklist-close").hide();this.selectList.data("open",false);this.selectList.css("display","none");this.textInput.val("");this.resList=a(this.model).lac_model("getSource");this._setResList(this.resList)}},_calcColumns:function(){var b=3;this.selectList.find(".lac-checklist-item").css("width",this.colWidths[b]);this.selectList.find(".lac-checklist-item").each(function(){if(a(this).outerHeight()>40){b=2}});this.selectList.find(".lac-checklist-item").css("width",this.colWidths[b])},_openSearch:function(){this.container.find(".lac-checklist-searchdiv").animate({width:"340px"},500);this.container.find(".lac-checklist-basebutton").html("");if(this.selectList.data("open")==false){this.container.find(".lac-checklist-close").show();this.selectList.data("open",true);this.selectList.css("display","flex");this._calcColumns()}},_resetSearch:function(){this.textInput.val("");this.resList=a(this.model).lac_model("getSource");this._setResList(this.resList);this.textInput.focus()},_setResList:function(c){this.selectList.empty();for(var b=0;b<c.length;b++){var d="";var e=" lws-icon-checkbox-unchecked";if(this.checkedList[c[b].value]!=undefined){d=" lac-checklist-item-selected";e=" lws-icon-checkbox-checked"}a("<div>",{"class":"lac-checklist-item lac-item-"+b+d,"data-value":c[b].value}).append(a("<div>",{"class":"lac-checklist-item-cb"+e})).append(a("<div>",{"class":"lac-checklist-item-label",html:c[b].label})).appendTo(this.selectList)}},_selectItem:function(c,d){this.preventNext=true;var b=a(c.currentTarget);if(b.hasClass("lac-checklist-item-selected")){b.removeClass("lac-checklist-item-selected");b.find(".lac-checklist-item-cb").removeClass("lws-icon-checkbox-checked").addClass("lws-icon-checkbox-unchecked");delete this.checkedList[b.data("value")]}else{b.addClass("lac-checklist-item-selected");b.find(".lac-checklist-item-cb").removeClass("lws-icon-checkbox-unchecked").addClass("lws-icon-checkbox-checked");this.checkedList[b.data("value")]=b[0].innerText}this._fillTagList();this._updateList()},_manageSearch:function(b){if(this.textInput.val()!=""){a(this.model).lac_model("research",this.textInput.val())}else{if(b[0]!="Tab"){this._resetSearch()}}},_manageKeys:function(b,c){if(b.key=="Backspace"||b.key=="Delete"||b.key=="Suppr"){}if(b.key=="Escape"||b.key=="Enter"||b.key=="Tab"){this._closeCheckList()}},_manageFocus:function(b){if(this.selectList.data("open")==true){if(a(b.originalEvent.target).closest(".lac-checklist-wrapper").length==0){this._closeCheckList()}}},_showError:function(b){this.container.find(".lac-checklist-error").html(b).show().delay(1000).fadeOut(500)},_ajaxLoading:function(){this.textInput.addClass("lac-loading")},_resultChanged:function(c){this.textInput.removeClass("lac-loading");if(c[1]=="ok"){if(c[0].length>0){this.resList=c[0];this._setResList(this.resList);this.selectList.data("open",true);this.selectList.css("display","flex");this._calcColumns()}else{this.resList=[];this.selectList.empty();this.selectList.data("open",false);this.selectList.hide()}}else{if(c[1]=="init"){for(var b=0;b<c[0].length;b++){this.checkedList[c[0][b].value]=c[0][b].label}this.resList=a(this.model).lac_model("getSource");this._setResList(this.resList);this._fillTagList();this._updateList()}else{this.resList=c[0];this._setResList(this.resList);this._showError(c[1])}}},_fillTagList:function(){this.tagsList.empty();var b=this;a.each(this.checkedList,function(c,d){a("<div>",{"class":"lac-tag-wrapper","data-value":c}).append(a("<div>",{"class":"lac-tag-text",html:d})).append(a("<a>",{"class":"lac-tag-remove lws-icon-cross"})).appendTo(b.tagsList)})},_delTag:function(c){var b=a(c.currentTarget).parent();delete this.checkedList[b.data("value")];b.remove();this._updateList();this._setResList(this.resList)},_updateList:function(){var b=this.container.find(".lac-checklist-values");b.empty();var c=this;keyTable=[];a.each(this.checkedList,function(d,e){a("<input>",{type:"hidden",name:c.name+"[]",value:d,"data-lw_dependant":c.name}).appendTo(b);keyTable.push(d)});this.element.data("value",lwsBase64.fromObj(keyTable))}})})(jQuery);jQuery(function(a){a(".lac_checklist").lac_checklist()});