(function(a){a.widget("lws.lac_input",{options:{classe:"",name:"",placeholder:"",delay:300,minsearch:2,minoption:2,minlength:1},_create:function(){this._setOptions();this._createStructure();this.currentIndex=-1;a(this.element).prop("autocomplete","off");a(this.element).lac_model({resChange:{target:this,fn:this._resultChanged},resLoad:{target:this,fn:this._ajaxLoading},mode:"research",dom:a(this.element),viewoptions:this.options});this.resList=a(this.element).lac_model("getSource");this._setResList(this.resList);this.container.on("blur",".lac-input-text",this._bind(this._manageFocus,this));this.container.on("click",".lac-input-item",this._bind(this._selectItem,this));this.container.on("keydown",this._bind(this._manageKeys,this));var b=this;var d;var c=[];this.container.keyup(function(e,f){c[0]=e.key;c[1]=e.keyCode;sentData=[c];d&&clearTimeout(d);d=setTimeout(b._bindD(b._manageSearch,b,sentData),b.options.delay)})},_bind:function(b,c){return function(){return b.apply(c,arguments)}},_bindD:function(b,c,d){return function(){return b.apply(c,d)}},_setOptions:function(){if(this.element.data("placeholder")!=undefined){this.options.placeholder=this.element.data("placeholder")}if(this.element.data("delay")!=undefined){this.options.delay=this.element.data("delay")}if(this.element.data("class")!=undefined){this.options.classe=this.element.data("class")}if(this.element.data("name")!=undefined){this.options.name=this.element.data("name")}},_createStructure:function(){this.container=this.element.parent();a("<div>",{"class":"lac-input-wrapper "}).append(a("<div>",{"class":"lac-input-list","data-open":false})).append(a("<div>",{"class":"lac-input-error"})).appendTo(this.container);this.element.addClass("lac-input-text").detach().prependTo(this.container.find(".lac-input-wrapper"));this.selectList=this.container.find(".lac-input-list");this.textInput=this.container.find(".lac-input-text").addClass(this.options.classe)},_setResList:function(c){this.selectList.empty();this.currentIndex=-1;for(var b=0;b<this.resList.length;b++){if(c[b].html!=undefined){a("<div>",{"class":"lac-input-item lac-item-"+b,"data-value":c[b].label,html:c[b].html}).appendTo(this.selectList)}else{a("<div>",{"class":"lac-input-item lac-item-"+b,"data-value":c[b].label,html:c[b].label}).appendTo(this.selectList)}}this.container.find(".lac-input-item").removeClass("lac-highlighted");this.textInput.outerWidth(this.selectList.outerWidth())},_selectItem:function(c,d){var e=a(c.currentTarget).data("value");for(var b=0;b<this.resList.length;b++){if(this.resList[b].label==e){this.textInput.val(this.resList[b].label);this.selectList.data("open",false);this.selectList.hide()}}},_showError:function(b){this.container.find(".lac-select-error").html(b).show().delay(1000).fadeOut(500)},_manageFocus:function(b,c){if(a(b.originalEvent.explicitOriginalTarget).closest(".lac-input-item").length>0){return}this.selectList.data("open",false);this.selectList.hide()},_manageSearch:function(b){if(/[a-zA-Z0-9-_ ]/.test(String.fromCharCode(b[1]))){a(this.element).lac_model("research",this.textInput.val())}},_manageKeys:function(b,c){if(b.key=="ArrowDown"){this.container.find(".lac-item-"+this.currentIndex).removeClass("lac-highlighted");this.currentIndex+=1;if(this.currentIndex>=this.resList.length){this.currentIndex=0}this.container.find(".lac-item-"+this.currentIndex).addClass("lac-highlighted");this.textInput.val(this.resList[this.currentIndex].label);if(this.selectList.data("open"==false)){this.selectList.data("open",true);this.selectList.show()}}if(b.key=="ArrowUp"){this.container.find(".lac-item-"+this.currentIndex).removeClass("lac-highlighted");this.currentIndex-=1;if(this.currentIndex<0){this.currentIndex=this.resList.length-1}this.container.find(".lac-item-"+this.currentIndex).addClass("lac-highlighted");this.textInput.val(this.resList[this.currentIndex].label);if(this.selectList.data("open"==false)){this.selectList.data("open",true);this.selectList.show()}}if(b.key=="Enter"){this.currentIndex=-1;this.selectList.data("open",false);this.selectList.hide();this.textInput.trigger("blur")}if(b.key=="Backspace"||b.key=="Delete"||b.key=="Suppr"){this.currentIndex=-1;this.selectList.data("open",false);this.selectList.hide()}},_ajaxLoading:function(){this.textInput.addClass("lac-loading")},_resultChanged:function(b){this.textInput.removeClass("lac-loading");if(b[1]!="ok"){this.resList=b[0];this._setResList(this.resList);this._showError(b[1])}else{if(b[0].length>0){this.resList=b[0];this._setResList(this.resList);if(b[2]==true){this.textInput.val(this.resList[0].label)}else{this.selectList.data("open",true);this.selectList.show()}}else{this.resList=[];this.selectList.data("open",false);this.selectList.hide();this.selectList.empty()}}}})})(jQuery);jQuery(function(a){a(".lac_input").lac_input()});