(function(a){a.widget("lws.lac_select",{options:{classe:"",name:"",placeholder:"",delay:300,minlength:1,minoptions:2,minsearch:1},_create:function(){this._setOptions();this._createStructure();this.currentIndex=-1;this.inHouse=false;initvalues=(this.element.val()!="")?[this.element.val()]:undefined;a(this.element).lac_model({resChange:{target:this,fn:this._resultChanged},resLoad:{target:this,fn:this._ajaxLoading},mode:"autocomplete",dom:a(this.element),viewoptions:this.options,initvalues:initvalues});if(this.element.val().length==0){this.resList=a(this.element).lac_model("getSource");this._setResList(this.resList)}this.container.on("click",".lac-select-ddbutton",this._bind(this._showHide,this));this.container.on("focusout",".lac-select-wrapper",this._bind(this._manageFocus,this));this.container.on("click",".lac-select-item",this._bind(this._selectItem,this));this.element.on("change",this._bind(this._changeElement,this));this.container.on("keydown",this._bind(this._manageKeys,this));var b=this;var d;var c=[];this.container.keyup(function(e,f){c[0]=e.key;c[1]=e.keyCode;sentData=[c];d&&clearTimeout(d);d=setTimeout(b._bindD(b._manageSearch,b,sentData),b.options.delay)})},_bind:function(b,c){return function(){return b.apply(c,arguments)}},_bindD:function(b,c,d){return function(){return b.apply(c,d)}},_setOptions:function(){if(this.element.data("placeholder")!=undefined){this.options.placeholder=this.element.data("placeholder")}if(this.element.data("delay")!=undefined){this.options.delay=this.element.data("delay")}if(this.element.data("class")!=undefined){this.options.classe=this.element.data("class")}if(this.element.data("name")!=undefined){this.options.name=this.element.data("name")}},_createStructure:function(){this.container=this.element.parent();a("<div>",{"class":"lac-select-wrapper "}).append(a("<div>",{"class":"lac-select-combo"}).append(a("<input>",{"class":"lac-select-input "+this.options.classe,placeholder:this.options.placeholder,name:this.options.name})).append(a("<div>",{"class":"lac-select-ddbutton lws-icon-select_arrow_down"}))).append(a("<div>",{"class":"lac-select-list","data-open":false})).append(a("<div>",{"class":"lac-select-error"})).appendTo(this.container);this.element.hide().detach().prependTo(this.container.find(".lac-select-wrapper"));this.selectList=this.container.find(".lac-select-list");this.textInput=this.container.find(".lac-select-input");this.textInput.prop("autocomplete","off")},_setResList:function(c){this.selectList.empty();this.currentIndex=-1;for(var b=0;b<c.length;b++){if(c[b].html!=undefined){a("<div>",{"class":"lac-select-item lac-item-"+b,"data-value":c[b].value,html:c[b].html}).appendTo(this.selectList)}else{a("<div>",{"class":"lac-select-item lac-item-"+b,"data-value":c[b].value,html:c[b].label}).appendTo(this.selectList)}}this.container.find(".lac-select-item").removeClass("lac-highlighted");this.textInput.outerWidth(this.selectList.outerWidth())},_selectItem:function(c,d){var e=a(c.currentTarget).data("value");for(var b=0;b<this.resList.length;b++){if(this.resList[b].value==e){this.currentIndex=b;if(this.element.val()!=this.resList[b].value){this._changeValue(this.resList[b].value)}this.textInput.val(this.resList[b].label);this.selectList.data("open",false);this.selectList.hide()}}},_changeElement:function(b){if(this.inHouse===true){this.inHouse=false}else{a(this.element).lac_model("returnLabels",[this.element.val()])}},_changeValue:function(b){this.inHouse=true;this.element.val(b);this.element.trigger("change")},_showHide:function(b,c){if(!this.selectList.data("open")){if(this.textInput.val().length==0){this.resList=a(this.element).lac_model("getSource");this._setResList(this.resList)}this.selectList.data("open",true);this.selectList.show();this.textInput.focus()}else{this.selectList.data("open",false);this.selectList.hide()}},_manageFocus:function(b,c){if(a(b.originalEvent.explicitOriginalTarget).closest(".lac-select-item").length>0){return}if(this.currentIndex==-1&&this.textInput.val()!=""){this._changeValue("");this.textInput.val("");this._showError("Incorrect Value")}this.selectList.data("open",false);this.selectList.hide()},_manageSearch:function(b){if(/[a-zA-Z0-9-_ ]/.test(String.fromCharCode(b[1]))){this.currentIndex=-1;a(this.element).lac_model("research",this.textInput.val(),false)}},_showError:function(b){this.container.find(".lac-select-error").html(b).show().delay(1000).fadeOut(500)},_manageKeys:function(d,e){if(d.key=="ArrowDown"){this.container.find(".lac-item-"+this.currentIndex).removeClass("lac-highlighted");this.currentIndex+=1;if(this.currentIndex>=this.resList.length){this.currentIndex=0}var c=this.container.find(".lac-item-"+this.currentIndex);c.addClass("lac-highlighted");this.textInput.val(this.resList[this.currentIndex].label);this.selectList.scrollTop(Math.floor(c.position().top)+Math.floor(this.selectList.scrollTop()));this._changeValue(this.resList[this.currentIndex].value);if(this.selectList.data("open"==false)){this.selectList.data("open",true);this.selectList.show()}}if(d.key=="ArrowUp"){this.container.find(".lac-item-"+this.currentIndex).removeClass("lac-highlighted");this.currentIndex-=1;if(this.currentIndex<0){this.currentIndex=this.resList.length-1}var c=this.container.find(".lac-item-"+this.currentIndex);c.addClass("lac-highlighted");this.textInput.val(this.resList[this.currentIndex].label);this.selectList.scrollTop(Math.floor(c.position().top)+Math.floor(this.selectList.scrollTop()));this._changeValue(this.resList[this.currentIndex].value);if(this.selectList.data("open"==false)){this.selectList.data("open",true);this.selectList.show()}}if(d.key=="Enter"){this.textInput.trigger("blur")}if(d.key=="Backspace"||d.key=="Delete"||d.key=="Suppr"){this.selectList.data("open",false);this.selectList.hide();this.currentIndex=-1;this._changeValue("");var b=this;setTimeout(function(){if(b.textInput.val().length==0){b.resList=a(b.element).lac_model("getSource");b._setResList(b.resList)}},50)}},_inputSelectRange:function(){if(this.textInput[0].setSelectionRange){var b=this.textInput.val();this.textInput.focus();this.textInput.val(this.resList[0].label);this.textInput[0].setSelectionRange(b.length,this.textInput.val().length);this._changeValue(this.resList[0].value)}},_ajaxLoading:function(){this.textInput.addClass("lac-loading")},_resultChanged:function(b){this.textInput.removeClass("lac-loading");if(b[1]=="ok"){if(b[0].length>0){this.resList=b[0];this._setResList(this.resList);this._inputSelectRange();this.currentIndex=0;this.container.find(".lac-item-"+this.currentIndex).addClass("lac-highlighted");this.selectList.data("open",true);this.selectList.show()}}else{if(b[1]=="init"){if(b[0].length>0){this.resList=b[0];this._setResList(this.resList);this.currentIndex=0;this.textInput.val(b[0][0].label)}}else{if(b[0].length>0){this.resList=b[0];this._setResList(this.resList);this._showError(b[1])}}}}})})(jQuery);jQuery(function(a){a(".lac_select").lac_select()});